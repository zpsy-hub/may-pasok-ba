<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>May Pasok Ba?</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #007bff;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --light-bg: #f8f9fa;
            --card-shadow: 0 2px 8px rgba(0,0,0,0.08);
            --text-primary: #212529;
            --text-secondary: #6c757d;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .main-container {
            max-width: 720px;
            margin: 0 auto;
            padding: 1.5rem 1rem;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .brand {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0 0 0.5rem 0;
            color: var(--primary);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 0;
            font-weight: 500;
        }
        
        /* Enhanced Disclaimer */
        .disclaimer-enhanced {
            background: linear-gradient(135deg, #fff3cd 0%, #ffe5a3 100%);
            border: 3px solid #ffc107;
            border-radius: 16px;
            padding: 1.25rem;
            margin: 1.5rem 0;
            text-align: center;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);
        }

        .disclaimer-icon {
            font-size: 2.5rem;
            display: block;
            margin-bottom: 0.75rem;
        }

        .disclaimer-enhanced strong {
            display: block;
            font-size: 1.1rem;
            color: #856404;
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }

        .disclaimer-enhanced p {
            color: #856404;
            font-size: 0.95rem;
            line-height: 1.6;
            margin: 0;
        }

        .disclaimer-enhanced .highlight {
            background: rgba(255, 255, 255, 0.6);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .holiday-greeting {
            text-align: center;
            padding: 1.25rem;
            background-color: var(--light-bg);
            border-radius: 16px;
            margin-bottom: 1.5rem;
            border: 2px solid #e9ecef;
        }

        .holiday-greeting h2 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .holiday-greeting p {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .content {
            padding: 0;
        }

        .lgu-selector {
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.75rem;
        }

        .lgu-selector select {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .lgu-selector select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        
        .btn-refresh {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: rgba(0,123,255,0.1);
            border: 2px solid rgba(0,123,255,0.2);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.3rem;
        }

        .btn-refresh:hover {
            background: rgba(0,123,255,0.2);
            transform: rotate(180deg);
        }

        .date-header {
            text-align: center;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
        }

        .alert-box {
            padding: 1rem;
            border-radius: 16px;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            font-weight: 600;
            text-align: center;
            box-shadow: var(--card-shadow);
        }

        .alert-box.typhoon {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffc107;
        }

        .alert-box.typhoon-direct {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .alert-box.no-typhoon {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        /* Prediction Card - Enhanced */
        .prediction-card {
            text-align: center;
            padding: 2rem 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 20px;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            border: 2px solid #dee2e6;
        }

        .recommendation-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 2rem;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .recommendation-badge.proceed { 
            background: #d4edda; 
            color: #155724; 
            border: 2px solid #28a745;
        }
        
        .recommendation-badge.monitor { 
            background: #fff3cd; 
            color: #856404; 
            border: 2px solid #ffc107;
        }
        
        .recommendation-badge.suspend { 
            background: #f8d7da; 
            color: #721c24; 
            border: 2px solid #dc3545;
        }

        .badge-caveat {
            display: block;
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-style: italic;
            font-weight: 500;
            text-transform: none;
            letter-spacing: normal;
            margin-top: 0.5rem;
        }

        .probability-text {
            font-size: 2rem;
            font-weight: 800;
            margin: 1rem 0;
            color: var(--text-primary);
        }

        .weather-icon-large {
            font-size: 60px;
            margin: 1rem 0;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .weather-description-section {
            text-align: center;
            font-size: 1rem;
            line-height: 1.7;
            color: var(--text-secondary);
            margin: 1rem 0 0 0;
            padding: 0 1rem;
        }

        /* Section Cards */
        .section-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--card-shadow);
        }

        .section-card h6 {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 1rem 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .reason-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 10px;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .reason-item:last-child {
            margin-bottom: 0;
        }

        .reason-item.typhoon-reason {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffc107;
        }

        .reason-item.model-reason {
            background: #e7f3ff;
            color: #004085;
            border: 1px solid #b3d9ff;
        }

        .reason-icon {
            font-size: 1.4rem;
            flex-shrink: 0;
        }

        /* Limitations Card */
        .limitations-card {
            background: #fff3e0;
            border: 2px solid #ff9800;
            border-left: 4px solid #ff9800;
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.15);
        }

        .limitations-card h6 {
            color: #e65100;
            margin-bottom: 1rem;
            font-size: 1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .limitations-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .limitations-card li {
            padding: 0.6rem 0 0.6rem 2rem;
            position: relative;
            color: #e65100;
            font-size: 0.9rem;
            line-height: 1.6;
            border-bottom: 1px solid rgba(230, 81, 0, 0.1);
        }

        .limitations-card li:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .limitations-card li:before {
            content: "‚ö†Ô∏è";
            position: absolute;
            left: 0;
            font-size: 1.2rem;
        }

        .weather-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .weather-metric {
            background: white;
            padding: 1rem;
            border-radius: 16px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.2s;
            cursor: help;
            box-shadow: var(--card-shadow);
        }

        .weather-metric:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,123,255,0.15);
        }

        .metric-icon { 
            font-size: 1.8rem; 
            margin-bottom: 0.5rem; 
        }
        
        .metric-value { 
            font-size: 1.3rem; 
            font-weight: 700; 
            color: var(--text-primary); 
            display: block; 
            margin-bottom: 0.5rem;
        }
        
        .metric-label { 
            font-size: 0.75rem; 
            color: var(--text-secondary); 
            display: block;
            line-height: 1.4;
        }
        
        .metric-context {
            font-size: 0.7rem;
            color: var(--success);
            font-weight: 600;
            margin-top: 0.5rem;
            display: block;
        }
        
        .metric-context.warning {
            color: var(--warning);
        }
        
        .metric-context.danger {
            color: var(--danger);
        }
        
        .hourly-forecast {
            margin-bottom: 1.5rem;
        }

        .hourly-forecast h6 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hourly-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 0.75rem;
        }
        
        .hour-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 16px;
            padding: 0.75rem 0.5rem;
            text-align: center;
            transition: all 0.2s;
            box-shadow: var(--card-shadow);
        }

        .hour-card.current {
            border-color: var(--primary);
            background: rgba(0,123,255,0.05);
        }

        .hour-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 16px rgba(0,123,255,0.15);
            border-color: var(--primary);
        }

        .hour-time { 
            font-size: 0.75rem; 
            font-weight: 700; 
            color: #495057; 
            margin-bottom: 0.5rem; 
        }

        .hour-card.current .hour-time {
            color: var(--primary);
        }

        .hour-icon { font-size: 2rem; margin: 0.5rem 0; }
        .hour-temp { font-size: 1rem; font-weight: 700; color: #1a1a1a; }
        .hour-rain { font-size: 0.7rem; color: var(--primary); margin-top: 0.5rem; }

        /* Credits Section */
        .credits-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 16px;
            padding: 1.25rem;
            margin: 1.5rem 0;
            text-align: center;
        }

        .credits-section h6 {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .credit-item {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin: 0.5rem 0;
            line-height: 1.5;
        }

        .credit-item a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .credit-item a:hover {
            text-decoration: underline;
        }

        .last-updated {
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin: 1.5rem 0;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .loading-spinner {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* How It Works Button */
        .how-it-works-btn {
            width: 100%;
            padding: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }

        .how-it-works-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,123,255,0.4);
        }

        /* Learn More Button */
        .learn-more-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(40,167,69,0.3);
            transition: all 0.3s;
            z-index: 1000;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 200px;
        }

        .learn-more-btn:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(40,167,69,0.4);
            color: white;
        }

        /* Feedback Button */
        .feedback-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
            transition: all 0.3s;
            z-index: 1000;
            width: 200px;
        }

        .feedback-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,123,255,0.4);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s ease;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #f8f9fa;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #e9ecef;
            color: var(--text-primary);
        }

        .modal-content h3 {
            margin: 0 0 1.5rem 0;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-section {
            margin-bottom: 1.5rem;
        }

        .modal-section h4 {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.75rem;
        }

        .modal-section p, .modal-section ul {
            font-size: 0.95rem;
            line-height: 1.7;
            color: var(--text-secondary);
        }

        .modal-section ul {
            padding-left: 1.5rem;
        }

        .modal-section li {
            margin-bottom: 0.5rem;
        }

        /* Feedback Modal specific */
        .feedback-question {
            margin-bottom: 1.5rem;
        }

        .feedback-question label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .rating-options {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .rating-option {
            flex: 1;
            min-width: 80px;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .rating-option:hover {
            border-color: var(--primary);
            background: rgba(0,123,255,0.05);
        }

        .rating-option.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .feedback-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 100px;
            transition: all 0.2s;
        }

        .feedback-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .feedback-submit {
            width: 100%;
            padding: 0.75rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 1rem;
        }

        .feedback-submit:hover {
            background: #0056b3;
        }

        .feedback-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .feedback-success {
            text-align: center;
            padding: 2rem;
        }

        .feedback-success-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .feedback-success h4 {
            color: var(--success);
            margin-bottom: 0.5rem;
        }

        /* Mobile Styles */
        @media (max-width: 767px) {
            .main-container {
                padding: 1rem;
            }

            .brand {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 0.9rem;
            }

            .date-header {
                font-size: 1.4rem;
            }

            .probability-text {
                font-size: 1.6rem;
            }

            .weather-icon-large {
                font-size: 50px;
            }

            .hourly-grid {
                grid-template-columns: 1fr;
            }

            .hour-card {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 0.75rem;
                text-align: left;
            }

            .hour-time {
                flex: 0 0 60px;
                text-align: left;
            }

            .hour-icon {
                flex: 0 0 40px;
                font-size: 2rem;
                margin: 0;
            }

            .hour-temp {
                flex: 1;
                text-align: center;
            }

            .hour-rain {
                flex: 0 0 70px;
                text-align: right;
            }

            .weather-grid {
                grid-template-columns: 1fr;
            }

            .weather-metric {
                display: flex;
                align-items: center;
                text-align: left;
                padding: 0.75rem;
            }

            .metric-icon {
                flex: 0 0 40px;
                margin: 0;
            }

            .metric-content {
                flex: 1;
                display: flex;
                flex-direction: column;
            }

            .metric-label {
                order: 1;
                margin-bottom: 0.25rem;
            }

            .metric-value {
                order: 2;
                margin: 0;
            }

            .metric-context {
                order: 3;
            }

            .feedback-btn, .learn-more-btn {
                bottom: 15px;
                right: 15px;
                padding: 0.6rem 1.2rem;
                font-size: 0.85rem;
            }

            .learn-more-btn {
                bottom: 70px;
            }

            .modal-content {
                padding: 1.5rem;
            }

            .modal-content h3 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <h1 class="brand">May Pasok Ba?</h1>
            <p class="subtitle">AI-Powered Decision Support for Metro Manila Class Suspensions</p>
        </div>

        <!-- Enhanced Contextual Disclaimer -->
        <div class="disclaimer-enhanced">
            <span class="disclaimer-icon">ü§ñ</span>
            <strong>This is a weather-based forecast, not an official announcement</strong>
            <p>Our AI analyzes weather patterns to help you plan ahead. Only your <span class="highlight">Local Government Unit (LGU)</span> can officially suspend classes. Always verify with official channels before making decisions.</p>
        </div>

        <!-- LGU Selector -->
        <div class="lgu-selector" id="topLguSelector" style="display: none;">
            <select id="lguSelect" onchange="handleLGUChange(this.value)"></select>
            <button class="btn-refresh" onclick="refreshData()" id="refreshBtn">
                <span id="refreshIcon">üîÑ</span>
            </button>
        </div>
        
        <!-- Daily greeting -->
        <div id="dailyGreeting" class="holiday-greeting" style="display: none;"></div>

        <div id="appContent">
            <div id="loading" class="loading-spinner">
                <div class="spinner"></div>
                <p>Loading predictions...</p>
            </div>
            
            <div class="content" id="mainContent" style="display: none;">
                <div class="date-header" id="dateText"></div>
                
                <!-- Typhoon alert -->
                <div id="typhoonAlert" style="display: none;"></div>

                <!-- Prediction card with softer language -->
                <div class="prediction-card">
                    <div class="recommendation-badge" id="recommendationBadge">
                        <span id="badgeIcon">üí≠</span>
                        <span id="badgeText"></span>
                    </div>
                    <span class="badge-caveat">based on current weather patterns</span>
                    <div class="probability-text" id="probabilityText"></div>
                    <div class="weather-icon-large" id="weatherIcon"></div>
                    <div class="weather-description-section" id="weatherDescription">Loading weather forecast...</div>
                </div>

                <!-- Recommendation Reasons -->
                <div id="recommendationReasons" class="section-card" style="display: none;">
                    <h6>üìã Recommendation Based On:</h6>
                    <div id="reasonsList"></div>
                </div>

                <!-- When We Might Be Wrong Section -->
                <div class="limitations-card">
                    <h6>‚ö†Ô∏è When Our Model Might Be Wrong</h6>
                    <ul>
                        <li>Sudden typhoon path changes (we update hourly, but weather is unpredictable)</li>
                        <li>Localized flooding not visible in regional weather data</li>
                        <li>LGU policy changes or special circumstances we can't predict</li>
                        <li>Political decisions unrelated to weather conditions</li>
                        <li>Very early morning weather changes after our last update</li>
                    </ul>
                </div>

                <!-- Weather metrics -->
                <div class="weather-grid" id="weatherMetricsGrid">
                    <div class="weather-metric">
                        <div class="metric-icon">üíß</div>
                        <div class="metric-content">
                            <span class="metric-label">Expected Total Rain Tomorrow</span>
                            <span class="metric-value" id="rainfallValue">--</span>
                            <span class="metric-context" id="rainfallContext">--</span>
                        </div>
                    </div>
                    <div class="weather-metric">
                        <div class="metric-icon">üí®</div>
                        <div class="metric-content">
                            <span class="metric-label">Max Wind Speed</span>
                            <span class="metric-value" id="windValue">--</span>
                            <span class="metric-context" id="windContext">--</span>
                        </div>
                    </div>
                    <div class="weather-metric">
                        <div class="metric-icon">üå°Ô∏è</div>
                        <div class="metric-content">
                            <span class="metric-label">Atmospheric Pressure</span>
                            <span class="metric-value" id="pressureValue">--</span>
                            <span class="metric-context" id="pressureContext">--</span>
                        </div>
                    </div>
                </div>

                <!-- Hourly forecast -->
                <div id="hourlyForecastSection" style="display: none;" class="hourly-forecast">
                    <h6>12-Hour Forecast</h6>
                    <div class="hourly-grid" id="hourlyContainer">
                        <p class="text-muted">Loading hourly data...</p>
                    </div>
                </div>

                <!-- How It Works Button -->
                <button class="how-it-works-btn" onclick="openHowItWorksModal()">
                    üß† How Does This Actually Work?
                </button>

                <!-- Credits Section -->
                <div class="credits-section">
                    <h6>Data Sources & Acknowledgments</h6>
                    <div class="credit-item">
                        Weather Data: <a href="https://open-meteo.com" target="_blank">Open-Meteo</a>
                    </div>
                    <div class="credit-item">
                        Typhoon Data Parser: <a href="https://github.com/pagasa-parser" target="_blank">PAGASA Parser</a> by <a href="https://github.com/ChlodAlejandro" target="_blank">ChlodAlejandro</a>
                    </div>
                </div>

                <div class="last-updated" id="lastUpdated"></div>
            </div>
        </div>
    </div>

    <!-- Feedback Button -->
    <button class="feedback-btn" onclick="openFeedbackModal()">üìù Send Feedback</button>

    <!-- Learn More Button -->
    <a href="learn-more.html" class="learn-more-btn">üìä Learn More</a>

    <!-- How It Works Modal -->
    <div class="modal" id="howItWorksModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeHowItWorksModal()">√ó</button>
            <h3>üß† How Does This Work?</h3>
            
            <div class="modal-section">
                <h4>What We Analyze</h4>
                <p>Our machine learning model considers multiple weather factors to predict class suspension likelihood:</p>
                <ul>
                    <li><strong>Rainfall forecasts</strong> - Amount and intensity of expected rain</li>
                    <li><strong>Wind speed</strong> - Strength of predicted winds</li>
                    <li><strong>Atmospheric pressure</strong> - Indicator of weather stability</li>
                    <li><strong>Active typhoons</strong> - Official PAGASA warnings and signals</li>
                    <li><strong>Historical patterns</strong> - Past LGU suspension decisions</li>
                </ul>
            </div>

            <div class="modal-section">
                <h4>How Accurate Are We?</h4>
                <p>Our model is trained on historical weather data and actual suspension decisions. While we strive for accuracy, weather forecasting is inherently uncertain. We recommend using our predictions as a planning tool, not a definitive answer.</p>
            </div>

            <div class="modal-section">
                <h4>What We DON'T Do</h4>
                <ul>
                    <li>We don't have access to LGU internal decision-making processes</li>
                    <li>We can't predict political or administrative factors</li>
                    <li>We can't account for very localized conditions (specific flooding, infrastructure issues)</li>
                    <li>We're not a replacement for official announcements</li>
                </ul>
            </div>

            <div class="modal-section">
                <h4>How to Use This Tool</h4>
                <p><strong>Best Practice:</strong> Check our prediction the evening before to help you plan. Then, always confirm with your LGU's official channels (Facebook, website, local radio) before making final decisions.</p>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="modal" id="feedbackModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeFeedbackModal()">√ó</button>
            
            <div id="feedbackForm">
                <h3>We'd Love Your Feedback!</h3>
                
                <div class="feedback-question">
                    <label>How helpful is this prediction tool?</label>
                    <div class="rating-options" id="helpfulnessRating">
                        <div class="rating-option" onclick="selectRating('helpfulness', 1)">Not Helpful</div>
                        <div class="rating-option" onclick="selectRating('helpfulness', 2)">Slightly Helpful</div>
                        <div class="rating-option" onclick="selectRating('helpfulness', 3)">Moderately Helpful</div>
                        <div class="rating-option" onclick="selectRating('helpfulness', 4)">Very Helpful</div>
                        <div class="rating-option" onclick="selectRating('helpfulness', 5)">Extremely Helpful</div>
                    </div>
                </div>

                <div class="feedback-question">
                    <label>How much do you trust these predictions?</label>
                    <div class="rating-options" id="trustRating">
                        <div class="rating-option" onclick="selectRating('trust', 1)">Very Low</div>
                        <div class="rating-option" onclick="selectRating('trust', 2)">Low</div>
                        <div class="rating-option" onclick="selectRating('trust', 3)">Moderate</div>
                        <div class="rating-option" onclick="selectRating('trust', 4)">High</div>
                        <div class="rating-option" onclick="selectRating('trust', 5)">Very High</div>
                    </div>
                </div>

                <div class="feedback-question">
                    <label>Additional Comments (Optional)</label>
                    <textarea class="feedback-textarea" id="feedbackComment" placeholder="Share your thoughts, suggestions, or any issues you encountered..."></textarea>
                </div>

                <input type="checkbox" name="botcheck" class="hidden" style="display: none;">

                <button class="feedback-submit" onclick="submitFeedback()" id="submitBtn">Submit Feedback</button>
            </div>

            <div id="feedbackSuccess" class="feedback-success" style="display: none;">
                <div class="feedback-success-icon">‚úÖ</div>
                <h4>Thank You!</h4>
                <p>Your feedback has been recorded and helps us improve.</p>
            </div>
        </div>
    </div>

    <script>
        const CACHE_KEY = 'may_pasok_ba_cache';
        const OPENMETEO_CACHE_KEY = 'openmeteo_cache';
        const HOLIDAY_CACHE_KEY = 'holiday_cache';
        const FEEDBACK_KEY = 'may_pasok_ba_feedback';
        const CACHE_DURATION = 3600000;
        const LGU_COORDS = { "Manila": { lat: 14.5995, lon: 120.9842 }, "Quezon City": { lat: 14.6508, lon: 121.0487 }, "Caloocan": { lat: 14.6538, lon: 120.9934 }, "Makati": { lat: 14.5547, lon: 121.0244 }, "Pasig": { lat: 14.5768, lon: 121.0854 }, "Taguig": { lat: 14.5176, lon: 121.0509 }, "Pasay": { lat: 14.5378, lon: 121.0016 }, "Mandaluyong": { lat: 14.5804, lon: 121.0336 }, "Para√±aque": { lat: 14.4793, lon: 121.0189 }, "Valenzuela": { lat: 14.7040, lon: 120.9844 }, "Las Pi√±as": { lat: 14.4449, lon: 120.9934 }, "Malabon": { lat: 14.6565, lon: 120.9634 }, "Marikina": { lat: 14.6465, lon: 121.1030 }, "Muntinlupa": { lat: 14.4084, lon: 121.0416 }, "Navotas": { lat: 14.6644, lon: 120.9392 }, "San Juan": { lat: 14.6019, lon: 121.0332 }, "Pateros": { lat: 14.5422, lon: 121.0664 } };

        const GREETINGS = [
            "Ready for another day?",
            "Let's check the forecast!",
            "Planning your day?",
            "What's the weather like?",
            "Time to prep for tomorrow!",
            "Let's see what's ahead!",
            "Checking the skies...",
            "Weather check time!",
            "Planning ahead?",
            "Let's look at tomorrow!"
        ];

        const DAY_NAMES = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

        let predictionData = null;
        let currentSelection = 'metro_manila';
        let feedbackData = {
            helpfulness: null,
            trust: null,
            comment: ''
        };

        function normalizeLGUName(name) {
            return name.normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/[^a-zA-Z0-9_]/g, '_');
        }

        async function init() {
            await generateDailyGreeting();
            
            const cached = getCache(CACHE_KEY);
            if (cached) {
                predictionData = cached;
                populateLGUDropdown();
                displayData();
            }
            fetchPredictions();
        }
        
        async function generateDailyGreeting() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const dailyGreetingDiv = document.getElementById('dailyGreeting');
            
            const dayName = DAY_NAMES[dayOfWeek];
            const holiday = await getHolidayForToday();
            
            let greeting;
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                greeting = `
                    <h2>It's ${dayName}! üéâ</h2>
                    <p>No classes today, but here's what tomorrow's forecast looks like.</p>
                `;
            } else if (holiday) {
                greeting = `
                    <h2>It's ${holiday.name}! üéä</h2>
                    <p>Holiday today, but here's what tomorrow's forecast looks like.</p>
                `;
            } else {
                const randomGreeting = GREETINGS[Math.floor(Math.random() * GREETINGS.length)];
                greeting = `
                    <h2>Happy ${dayName}! üëã</h2>
                    <p>${randomGreeting}</p>
                `;
            }
            
            dailyGreetingDiv.innerHTML = greeting;
            dailyGreetingDiv.style.display = 'block';
        }

        async function getHolidayForToday() {
            const today = new Date();
            const year = today.getFullYear();
            const todayStr = today.toISOString().split('T')[0];

            let holidays = getCache(`${HOLIDAY_CACHE_KEY}_${year}`);
            if (!holidays) {
                try {
                    const response = await fetch(`https://date.nager.at/api/v3/PublicHolidays/${year}/PH`);
                    if (!response.ok) throw new Error('Failed to fetch holidays');
                    holidays = await response.json();
                    setCache(`${HOLIDAY_CACHE_KEY}_${year}`, holidays);
                } catch (error) {
                    console.error("Could not fetch holiday data:", error);
                    return null;
                }
            }
            
            return holidays.find(h => h.date === todayStr);
        }

        function getCache(key) {
            const cached = localStorage.getItem(key);
            if (!cached) return null;
            const { data, timestamp } = JSON.parse(cached);
            if (Date.now() - timestamp > CACHE_DURATION) {
                localStorage.removeItem(key);
                return null;
            }
            return data;
        }

        function setCache(key, data) {
            localStorage.setItem(key, JSON.stringify({ data, timestamp: Date.now() }));
        }

        async function fetchPredictions() {
            try {
                const response = await fetch(`predictions/latest.json`);
                if (!response.ok) throw new Error('Failed to fetch predictions');
                const data = await response.json();
                predictionData = data;
                setCache(CACHE_KEY, data);
                populateLGUDropdown();
                displayData();
            } catch (error) {
                console.error('Error fetching predictions:', error);
                if (!predictionData) {
                    showError('Unable to load predictions. Please try again later.');
                }
            }
        }

        function populateLGUDropdown() {
            const select = document.getElementById('lguSelect');
            select.innerHTML = '<option value="metro_manila">Metro Manila Overview</option>';

            if (predictionData && predictionData.predictions) {
                predictionData.predictions
                    .filter(p => p.status === 'success')
                    .sort((a, b) => b.suspension_probability - a.suspension_probability)
                    .forEach(pred => {
                        const option = document.createElement('option');
                        option.value = pred.lgu;
                        option.textContent = `${pred.lgu} (~${(pred.suspension_probability * 100).toFixed(0)}%)`;
                        select.appendChild(option);
                    });
            }
            select.value = currentSelection;
            document.getElementById('topLguSelector').style.display = 'flex';
        }

        async function handleLGUChange(value) {
            currentSelection = value;
            await displayData();
        }
        
        async function displayData() {
            if (!predictionData) return;
            document.getElementById('loading').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';

            document.getElementById('dateText').textContent = getTomorrowDate();

            currentSelection === 'metro_manila' ? displayMetroManilaSummary() : await displayLGUDetails(currentSelection);
            
            updateTyphoonAlert();

            const timestamp = new Date(predictionData.metadata.timestamp);
            document.getElementById('lastUpdated').textContent = `Last updated: ${timestamp.toLocaleString('en-US', { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit', hour12: true })}`;
        }

        function displayMetroManilaSummary() {
            document.getElementById('hourlyForecastSection').style.display = 'none';
            const summary = predictionData.metro_manila_summary;
            const predictions = predictionData.predictions.filter(p => p.status === 'success');
            const avgProbability = predictions.reduce((sum, p) => sum + p.suspension_probability, 0) / predictions.length;
            const avgRainfall = predictions.reduce((sum, p) => sum + p.key_factors.forecasted_rainfall_24h, 0) / predictions.length;
            const avgWind = predictions.reduce((sum, p) => sum + p.key_factors.wind_speed_max, 0) / predictions.length;
            const avgPressure = predictions.reduce((sum, p) => sum + p.key_factors.pressure_mean, 0) / predictions.length;
            
            updateWeatherMetrics(avgRainfall, avgWind, avgPressure);
            updateRecommendationReasons(summary, predictions[0]);
            updateRecommendationBadge(summary.overall_recommendation);
            
            document.getElementById('probabilityText').textContent = `~${(avgProbability * 100).toFixed(0)}% Average Risk`;
            document.getElementById('weatherIcon').textContent = getWeatherIcon(avgRainfall, avgWind);
            document.getElementById('weatherDescription').textContent = generateWeatherDescription(avgRainfall, avgWind, null);
        }

        async function displayLGUDetails(lguName) {
            const lgu = predictionData.predictions.find(p => p.lgu === lguName);
            if (!lgu) return;
            
            updateWeatherMetrics(lgu.key_factors.forecasted_rainfall_24h, lgu.key_factors.wind_speed_max, lgu.key_factors.pressure_mean);
            updateRecommendationReasons(null, lgu);
            updateRecommendationBadge(lgu.recommendation);
            
            document.getElementById('probabilityText').textContent = `~${(lgu.suspension_probability * 100).toFixed(0)}% Suspension Risk`;
            document.getElementById('weatherIcon').textContent = getWeatherIcon(lgu.key_factors.forecasted_rainfall_24h, lgu.key_factors.wind_speed_max);
            
            await displayHourlyForecast(lguName);
        }

        function updateRecommendationBadge(recommendation) {
            const badge = document.getElementById('recommendationBadge');
            const badgeText = document.getElementById('badgeText');
            const badgeIcon = document.getElementById('badgeIcon');
            
            // Softer language with uncertainty indicators
            let text = '';
            let icon = 'üí≠';
            
            if (recommendation === 'PROCEED') {
                text = 'Likely Safe to Proceed';
                icon = 'üí≠';
            } else if (recommendation === 'MONITOR') {
                text = 'Monitor Conditions';
                icon = 'üëÄ';
            } else if (recommendation === 'SUSPEND') {
                text = 'High Risk - Stay Alert';
                icon = '‚ö†Ô∏è';
            }
            
            badgeIcon.textContent = icon;
            badgeText.textContent = text;
            badge.className = `recommendation-badge ${recommendation.toLowerCase()}`;
        }

        function updateRecommendationReasons(summary, lguData) {
            const reasonsContainer = document.getElementById('recommendationReasons');
            const reasonsList = document.getElementById('reasonsList');
            reasonsList.innerHTML = '';
            
            let hasReasons = false;
            
            if (lguData && lguData.pagasa_status && lguData.pagasa_status.hasActiveTyphoon) {
                if (lguData.pagasa_status.metroManilaAffected) {
                    reasonsList.innerHTML += `
                        <div class="reason-item typhoon-reason">
                            <span class="reason-icon">üåÄ</span>
                            <span>Official typhoon warning: <strong>${lguData.pagasa_status.typhoonName}</strong> affecting Metro Manila (TCWS #${lguData.pagasa_status.tcwsLevel})</span>
                        </div>
                    `;
                    hasReasons = true;
                }
            }
            
            const rainfall = lguData ? lguData.key_factors.forecasted_rainfall_24h : 0;
            const wind = lguData ? lguData.key_factors.wind_speed_max : 0;
            const probability = lguData ? lguData.suspension_probability : (summary ? 0.5 : 0);
            
            if (rainfall > 30 || wind > 60 || probability > 0.6) {
                let riskFactors = [];
                if (rainfall > 30) riskFactors.push(`heavy rainfall (~${rainfall.toFixed(1)}mm)`);
                if (wind > 60) riskFactors.push(`strong winds (~${wind.toFixed(0)} km/h)`);
                if (probability > 0.6) riskFactors.push(`high suspension probability (~${(probability * 100).toFixed(0)}%)`);
                
                reasonsList.innerHTML += `
                    <div class="reason-item model-reason">
                        <span class="reason-icon">ü§ñ</span>
                        <span>Model predicts weather risk: ${riskFactors.join(', ')}</span>
                    </div>
                `;
                hasReasons = true;
            }
            
            reasonsContainer.style.display = hasReasons ? 'block' : 'none';
        }

        function updateWeatherMetrics(rainfall, wind, pressure) {
            document.getElementById('rainfallValue').textContent = `~${rainfall.toFixed(1)}mm`;
            const rainfallContext = document.getElementById('rainfallContext');
            if (rainfall < 2.5) {
                rainfallContext.textContent = 'Light or no rain';
                rainfallContext.className = 'metric-context';
            } else if (rainfall < 7.5) {
                rainfallContext.textContent = 'Light rain';
                rainfallContext.className = 'metric-context';
            } else if (rainfall < 15) {
                rainfallContext.textContent = 'Moderate rain';
                rainfallContext.className = 'metric-context warning';
            } else if (rainfall < 30) {
                rainfallContext.textContent = 'Heavy rain';
                rainfallContext.className = 'metric-context warning';
            } else {
                rainfallContext.textContent = 'Very heavy rain';
                rainfallContext.className = 'metric-context danger';
            }

            document.getElementById('windValue').textContent = `~${wind.toFixed(0)} km/h`;
            const windContext = document.getElementById('windContext');
            if (wind < 20) {
                windContext.textContent = 'Calm to light breeze';
                windContext.className = 'metric-context';
            } else if (wind < 39) {
                windContext.textContent = 'Moderate breeze';
                windContext.className = 'metric-context';
            } else if (wind < 62) {
                windContext.textContent = 'Strong winds';
                windContext.className = 'metric-context warning';
            } else if (wind < 88) {
                windContext.textContent = 'Gale force winds';
                windContext.className = 'metric-context danger';
            } else {
                windContext.textContent = 'Storm force winds';
                windContext.className = 'metric-context danger';
            }

            document.getElementById('pressureValue').textContent = `~${pressure.toFixed(0)} hPa`;
            const pressureContext = document.getElementById('pressureContext');
            if (pressure < 1000) {
                pressureContext.textContent = 'Very low (stormy)';
                pressureContext.className = 'metric-context danger';
            } else if (pressure < 1010) {
                pressureContext.textContent = 'Low (unstable)';
                pressureContext.className = 'metric-context warning';
            } else if (pressure < 1020) {
                pressureContext.textContent = 'Normal (stable)';
                pressureContext.className = 'metric-context';
            } else {
                pressureContext.textContent = 'High (fair weather)';
                pressureContext.className = 'metric-context';
            }
        }

        async function displayHourlyForecast(lguName) {
            const coords = LGU_COORDS[lguName];
            if (!coords) {
                document.getElementById('hourlyForecastSection').style.display = 'none';
                return;
            }

            const normalizedName = normalizeLGUName(lguName);
            const cacheKey = `${OPENMETEO_CACHE_KEY}_${normalizedName}`;
            let hourlyData = getCache(cacheKey);

            if (!hourlyData) {
                try {
                    const url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&hourly=temperature_2m,precipitation,precipitation_probability,weather_code&current=temperature_2m,precipitation,weather_code&timezone=Asia/Manila&forecast_days=2`;
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('OpenMeteo API error');
                    const data = await response.json();
                    hourlyData = {
                        hourly: data.hourly,
                        current: data.current
                    };
                    setCache(cacheKey, hourlyData);
                } catch (error) {
                    console.error('Error fetching hourly data:', error);
                    document.getElementById('hourlyForecastSection').style.display = 'none';
                    return;
                }
            }
            renderHourlyForecast(hourlyData);
        }

        function renderHourlyForecast(data) {
            const container = document.getElementById('hourlyContainer');
            container.innerHTML = '';

            const now = new Date();
            const currentHour = now.getHours();
            
            const current = data.current;
            const hourlyTimes = data.hourly.time.map(t => new Date(t));
            const currentIndex = hourlyTimes.findIndex(t => t.getHours() === currentHour && t.getDate() === now.getDate());
            
            if (currentIndex === -1) {
                container.innerHTML = '<p class="text-muted">No hourly data available</p>';
                return;
            }

            const hours = [];
            
            hours.push({
                time: now,
                temp: current.temperature_2m,
                rain: current.precipitation || 0,
                code: current.weather_code,
                probability: data.hourly.precipitation_probability[currentIndex] || 0,
                isCurrent: true
            });

            for (let i = 1; i <= 11; i++) {
                const index = currentIndex + i;
                if (index < hourlyTimes.length) {
                    hours.push({
                        time: hourlyTimes[index],
                        temp: data.hourly.temperature_2m[index],
                        rain: data.hourly.precipitation[index],
                        code: data.hourly.weather_code[index],
                        probability: data.hourly.precipitation_probability[index] || 0,
                        isCurrent: false
                    });
                }
            }

            if (hours.length === 0) {
                container.innerHTML = '<p class="text-muted">No hourly data available</p>';
                return;
            }

            document.getElementById('hourlyForecastSection').style.display = 'block';
            
            const weatherDesc = generateWeatherDescriptionFromHourly(hours);
            document.getElementById('weatherDescription').textContent = weatherDesc;
            
            hours.forEach(hour => {
                const card = document.createElement('div');
                card.className = 'hour-card' + (hour.isCurrent ? ' current' : '');
                const timeStr = hour.isCurrent ? 'Now' : hour.time.toLocaleTimeString('en-US', { hour: 'numeric', hour12: true });
                card.innerHTML = `
                    <div class="hour-time">${timeStr}</div>
                    <div class="hour-icon">${getWeatherIconFromCode(hour.code)}</div>
                    <div class="hour-temp">${Math.round(hour.temp)}¬∞C</div>
                    <div class="hour-rain">üíß ~${hour.rain.toFixed(1)}mm (${hour.probability}%)</div>
                `;
                container.appendChild(card);
            });
        }

        function generateWeatherDescriptionFromHourly(hours) {
            if (hours.length === 0) return "Weather data unavailable";

            const rainyHours = hours.filter(h => h.rain > 0.5);
            const totalRain = hours.reduce((sum, h) => sum + h.rain, 0);
            const avgTemp = hours.reduce((sum, h) => sum + h.temp, 0) / hours.length;

            let description = "For tomorrow, expect ";

            if (avgTemp > 32) {
                description += "hot and humid conditions";
            } else if (avgTemp > 28) {
                description += "warm weather";
            } else if (avgTemp > 24) {
                description += "pleasant temperatures";
            } else {
                description += "cool weather";
            }

            if (rainyHours.length === 0) {
                description += " with clear skies";
            } else if (rainyHours.length >= hours.length * 0.7) {
                description += ", with rain throughout the day";
            } else if (rainyHours.length >= hours.length * 0.4) {
                description += " with scattered rain showers";
            } else {
                const firstRainIndex = hours.findIndex(h => h.rain > 0.5);
                
                if (firstRainIndex !== -1) {
                    const firstRainHour = hours[firstRainIndex].time.getHours();
                    
                    if (firstRainHour >= 0 && firstRainHour < 6) {
                        description += ", with rain during early morning";
                    } else if (firstRainHour >= 6 && firstRainHour < 12) {
                        description += ", with rain in the morning";
                    } else if (firstRainHour >= 12 && firstRainHour < 18) {
                        description += ", with rain in the afternoon";
                    } else {
                        description += ", with rain in the evening";
                    }
                }
            }

            if (totalRain > 20) {
                description += ". Heavy rainfall expected";
            } else if (totalRain > 10) {
                description += ". Moderate rainfall expected";
            } else if (totalRain > 2) {
                description += ". Light showers expected";
            }

            return description + ".";
        }

        function generateWeatherDescription(rainfall, wind, hourlyData) {
            let description = "For tomorrow, expect ";

            if (rainfall > 50) {
                description += "heavy rains and thunderstorms throughout the day";
            } else if (rainfall > 20) {
                description += "moderate to heavy rainfall";
            } else if (rainfall > 10) {
                description += "scattered rain showers";
            } else if (rainfall > 2) {
                description += "partly cloudy skies with occasional light rain";
            } else {
                description += "mostly sunny with partly cloudy skies";
            }

            if (wind > 60) {
                description += ". Strong winds, stay indoors if possible";
            } else if (wind > 40) {
                description += ". Windy conditions expected";
            } else if (wind > 25) {
                description += ". Moderate winds";
            }

            return description + ".";
        }

        function updateTyphoonAlert() {
            const alertDiv = document.getElementById('typhoonAlert');
            if (!predictionData.predictions || predictionData.predictions.length === 0) {
                alertDiv.style.display = 'none';
                return;
            }
            
            const pagasaStatus = predictionData.predictions[0].pagasa_status;
            if (pagasaStatus && pagasaStatus.hasActiveTyphoon) {
                alertDiv.style.display = 'block';
                
                if (pagasaStatus.metroManilaAffected) {
                    alertDiv.className = 'alert-box typhoon-direct';
                    alertDiv.innerHTML = `‚ö†Ô∏è Active Typhoon: <strong>${pagasaStatus.typhoonName}</strong> - Metro Manila under TCWS Signal #${pagasaStatus.tcwsLevel}`;
                } else {
                    alertDiv.className = 'alert-box typhoon';
                    alertDiv.innerHTML = `‚ö†Ô∏è Active Typhoon: <strong>${pagasaStatus.typhoonName}</strong> - Metro Manila not directly affected`;
                }
            } else {
                alertDiv.style.display = 'block';
                alertDiv.className = 'alert-box no-typhoon';
                alertDiv.innerHTML = '‚úÖ No active typhoons affecting Metro Manila';
            }
        }

        function getWeatherIcon(rainfall, wind) {
            if (rainfall > 50 || wind > 60) return '‚õàÔ∏è';
            if (rainfall > 20) return 'üåßÔ∏è';
            if (rainfall > 5) return 'üå¶Ô∏è';
            if (wind > 40) return 'üí®';
            return '‚õÖ';
        }

        function getWeatherIconFromCode(code) {
            if (code === 0) return '‚òÄÔ∏è';
            if (code <= 3) return '‚õÖ';
            if (code <= 48) return 'üå´Ô∏è';
            if (code <= 67) return 'üåßÔ∏è';
            if (code <= 77) return 'üå®Ô∏è';
            if (code <= 82) return 'üåßÔ∏è';
            if (code <= 86) return 'üå®Ô∏è';
            if (code <= 99) return '‚õàÔ∏è';
            return 'üå§Ô∏è';
        }

        function getTomorrowDate() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            return tomorrow.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
        }

        function showError(message) {
            document.getElementById('loading').innerHTML = `<div class="alert alert-danger"><strong>Error:</strong> ${message}</div>`;
        }

        async function refreshData() {
            const btn = document.getElementById('refreshBtn');
            btn.disabled = true;
            btn.style.animation = 'spin 1s linear';
            
            localStorage.removeItem(CACHE_KEY);
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith(OPENMETEO_CACHE_KEY)) {
                    localStorage.removeItem(key);
                }
            });
            
            await fetchPredictions();
            
            setTimeout(() => {
                btn.disabled = false;
                btn.style.animation = '';
            }, 1000);
        }

        function openHowItWorksModal() {
            document.getElementById('howItWorksModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeHowItWorksModal() {
            document.getElementById('howItWorksModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function openFeedbackModal() {
            document.getElementById('feedbackModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeFeedbackModal() {
            document.getElementById('feedbackModal').classList.remove('active');
            document.body.style.overflow = '';
            
            setTimeout(() => {
                document.getElementById('feedbackForm').style.display = 'block';
                document.getElementById('feedbackSuccess').style.display = 'none';
                resetFeedbackForm();
            }, 300);
        }

        function selectRating(type, value) {
            feedbackData[type] = value;
            
            const containerId = type === 'helpfulness' ? 'helpfulnessRating' : 'trustRating';
            const container = document.getElementById(containerId);
            const options = container.querySelectorAll('.rating-option');
            
            options.forEach((option, index) => {
                if (index + 1 === value) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        }

        async function submitFeedback() {
            const comment = document.getElementById('feedbackComment').value.trim();
            feedbackData.comment = comment;
            
            if (feedbackData.helpfulness === null && feedbackData.trust === null) {
                alert('Please provide at least one rating before submitting.');
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            saveFeedback();
            
            try {
                await sendToWeb3Forms();
            } catch (error) {
                console.error('Error sending to Web3Forms:', error);
            }
            
            setTimeout(() => {
                document.getElementById('feedbackForm').style.display = 'none';
                document.getElementById('feedbackSuccess').style.display = 'block';
                
                setTimeout(() => {
                    closeFeedbackModal();
                }, 3000);
            }, 500);
        }

        async function sendToWeb3Forms() {
            const formData = new FormData();
            formData.append('access_key', 'a829bc24-af6b-4f40-9558-e453e34d1dee');
            formData.append('subject', 'May Pasok Ba Feedback');
            formData.append('helpfulness', feedbackData.helpfulness || 'Not rated');
            formData.append('trust', feedbackData.trust || 'Not rated');
            formData.append('comment', feedbackData.comment || 'No comment');
            formData.append('lgu', currentSelection);
            formData.append('timestamp', new Date().toISOString());
            
            const response = await fetch('https://api.web3forms.com/submit', {
                method: 'POST',
                body: formData
            });
            
            return response.json();
        }
        
        function saveFeedback() {
            const feedback = {
                ...feedbackData,
                timestamp: new Date().toISOString(),
                currentLGU: currentSelection,
                userAgent: navigator.userAgent
            };
            
            let allFeedback = [];
            try {
                const stored = localStorage.getItem(FEEDBACK_KEY);
                if (stored) {
                    allFeedback = JSON.parse(stored);
                }
            } catch (e) {
                console.error('Error reading feedback:', e);
            }
            
            allFeedback.push(feedback);
            
            if (allFeedback.length > 100) {
                allFeedback = allFeedback.slice(-100);
            }
            
            try {
                localStorage.setItem(FEEDBACK_KEY, JSON.stringify(allFeedback));
                console.log('Feedback saved:', feedback);
            } catch (e) {
                console.error('Error saving feedback:', e);
            }
        }

        function resetFeedbackForm() {
            feedbackData = {
                helpfulness: null,
                trust: null,
                comment: ''
            };
            
            document.querySelectorAll('.rating-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.getElementById('feedbackComment').value = '';
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('submitBtn').textContent = 'Submit Feedback';
        }

        document.getElementById('feedbackModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeFeedbackModal();
            }
        });

        document.getElementById('howItWorksModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeHowItWorksModal();
            }
        });
        
        setInterval(() => {
            fetchPredictions();
        }, 3600000);

        init();
    </script>
</body>
</html>